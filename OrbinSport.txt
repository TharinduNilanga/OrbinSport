
DROP DATABASE OrbinSport;
CREATE DATABASE IF NOT EXISTS OrbinSport;
USE OrbinSport;

CREATE TABLE IF NOT EXISTS User(
	userId VARCHAR(10),
	userName VARCHAR(10),
	password VARCHAR(200),
	CONSTRAINT PRIMARY KEY(userId)
);	
CREATE TABLE IF NOT EXISTS Admin(
	adminId VARCHAR(10),
	userName VARCHAR(10),
	password VARCHAR(200),
	CONSTRAINT PRIMARY KEY(adminId)
);
CREATE TABLE IF NOT EXISTS Customer(
	cId VARCHAR(10),
	userId VARCHAR(10),
	name VARCHAR(20)NOT NULL DEFAULT 'UnKnown',
	NIC VARCHAR(20)NOT NULL DEFAULT 'Empty',
	phoneNo VARCHAR(10),
	CONSTRAINT PRIMARY KEY(cId,userId),
	CONSTRAINT FOREIGN KEY(userId) REFERENCES User(userId)ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS Supplier(
	sId VARCHAR(10),
	brand VARCHAR(30),
	description VARCHAR(50),
	company VARCHAR(20),
	CONSTRAINT PRIMARY KEY(sId)
	
);
CREATE TABLE IF NOT EXISTS Products(
	productId VARCHAR(10),
	description VARCHAR(30) NOT NULL DEFAULT 'Empty',
	brand VARCHAR(30),
	qty INT(10),
	unitPrice double,
	CONSTRAINT PRIMARY KEY (productId)
	
);
CREATE TABLE IF NOT EXISTS RepairProducts(
	repairProductId VARCHAR(10),
	description VARCHAR(30) NOT NULL DEFAULT 'Empty',
	qty INT(10),
	unitPrice double,
	CONSTRAINT PRIMARY KEY (repairProductId)
	
);


CREATE TABLE IF NOT EXISTS `Order`(
 	orderId VARCHAR(10),
	customerId VARCHAR(10),
	pId VARCHAR(10),
	warranty VARCHAR(10)NOT NULL DEFAULT 'Empty',
	orderType VARCHAR(10)NOT NULL DEFAULT 'Empty',
	qty INT(10),
	discout INT(10),
	unitPrice double,
	orderDate DATE,
	CONSTRAINT PRIMARY KEY(orderId),
	CONSTRAINT FOREIGN KEY(customerId) REFERENCES Customer(cId)ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(pId) REFERENCES Products(productId)ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS `OrderDetails`(
	oId VARCHAR(10),
	pId VARCHAR(10),
	orderType VARCHAR(30)NOT NULL DEFAULT 'Empty',
	qty INT(10),
	discout INT(10),
	unitPrice double,
	CONSTRAINT PRIMARY KEY(oId,pId),
	CONSTRAINT FOREIGN KEY (oId) REFERENCES `Order`(orderId),
	CONSTRAINT FOREIGN KEY(pId) REFERENCES Products(productId)
);
        

CREATE TABLE IF NOT EXISTS Repairs(
	repairNo VARCHAR(10),
	customerId VARCHAR(10),
	repairType VARCHAR(30)NOT NULL DEFAULT 'Empty',
	price double,
	CONSTRAINT PRIMARY KEY(repairNo,customerId),
	CONSTRAINT FOREIGN KEY(customerId) REFERENCES Customer(cId)ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE IF NOT EXISTS FinishedRepairs(
	repairNo VARCHAR(10),
	customerId VARCHAR(10),
	repairType VARCHAR(30)NOT NULL DEFAULT 'Empty',
	productsUsed VARCHAR(10)NOT NULL DEFAULt'Empty',
	qty int(10),
	totalPrice double,
	CONSTRAINT PRIMARY KEY(repairNo),
	CONSTRAINT FOREIGN KEY(customerId) REFERENCES Customer(cId)ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(productsUsed) REFERENCES RepairProducts(repairProductId)ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS Returns(
	returnNo VARCHAR(10),
	orderId VARCHAR(10),
	userId VARCHAR(10),
	returnedItems VARCHAR(60),
	cost double,
	CONSTRAINT PRIMARY KEY(returnNo),
	CONSTRAINT FOREIGN KEY (orderId) REFERENCES `Order`(orderId) ,
	CONSTRAINT FOREIGN KEY(userId) REFERENCES User(userId)ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FOREIGN KEY(returnedItems) REFERENCES Products(productId)ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS Income(
	income double	
);
CREATE TABLE IF NOT EXISTS MoreMovableProducts(
	pId VARCHAR(10),
	description VARCHAR(40)NOT NULL DEFAULT'Empty',
	prices double,
	CONSTRAINT PRIMARY KEY(pId),
	CONSTRAINT FOREIGN KEY(pId) REFERENCES Products(productId)ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE IF NOT EXISTS LeastMovableProducts(
	pId VARCHAR(10),
	description VARCHAR(40)NOT NULL DEFAULT'Empty',
        prices double,
	CONSTRAINT PRIMARY KEY(pId),
	CONSTRAINT FOREIGN KEY(pId) REFERENCES Products(productId)ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE IF NOT EXISTS CashInHand(
	cash double
);

